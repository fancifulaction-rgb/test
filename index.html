<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –û—Ö–æ—Ç–∞ –∑–∞ –°–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ v5.3.2 ADVANCED RATING üéÑ</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
    <script src="firebase-config.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 1em;
            opacity: 0.8;
            animation: fall linear infinite;
            z-index: 0;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header .version {
            color: #666;
            font-size: 14px;
            background: #f0f0f0;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
        }

        .start-screen, .game-screen, .end-screen {
            display: none;
        }

        .start-screen.active, .game-screen.active, .end-screen.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .timer-container {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .timer-title {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .task-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .task-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .task-title {
            flex: 1;
            margin-left: 15px;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .task-score {
            background: #f39c12;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
        }

        .task-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .task-hint-section {
            margin-bottom: 20px;
        }

        .btn-hint {
            background: #f39c12;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .btn-hint:hover {
            background: #e67e22;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .task-hint {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-style: italic;
            animation: hintSlideDown 0.3s ease;
        }

        @keyframes hintSlideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-code {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .task-code input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .task-code input:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn-check-code {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .btn-check-code:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-check-code:active {
            transform: translateY(0);
        }

        .progress-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #f0f0f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            color: #333;
            font-weight: 500;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            color: #27ae60;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .modal-content .trophy {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .stats {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .stat-item:last-child {
            margin-bottom: 0;
            font-weight: bold;
            font-size: 20px;
            color: #27ae60;
        }

        .final-score {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .timer-display {
                font-size: 36px;
            }
            
            .task-code {
                flex-direction: column;
            }
            
            .btn-check-code {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –°–Ω–µ–∂–∏–Ω–∫–∏ -->
    <div class="snowflake">‚ùÑ</div>
    <div class="snowflake">‚ùÖ</div>
    <div class="snowflake">‚ùÜ</div>
    <div class="snowflake">‚ùÑ</div>
    <div class="snowflake">‚ùÖ</div>
    <div class="snowflake">‚ùÜ</div>
    <div class="snowflake">‚ùÑ</div>
    <div class="snowflake">‚ùÖ</div>

    <div class="container">
        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div class="start-screen active" id="startScreen">
            <div class="header">
                <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –û—Ö–æ—Ç–∞ –∑–∞ –°–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</h1>
                <div class="version">v5.3.2 ADVANCED RATING - –ó–∞—â–∏—â–µ–Ω–æ QR-–∫–æ–¥–æ–º</div>
            </div>

            <div style="text-align: center; margin-bottom: 30px;">
                <p style="font-size: 18px; color: #666; line-height: 1.6;">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–µ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!<br>
                    –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ –∫–æ–¥—ã –∏ —Å—Ç–∞–Ω—å—Ç–µ —á–µ–º–ø–∏–æ–Ω–æ–º –ø—Ä–∞–∑–¥–Ω–∏–∫–∞!
                </p>
            </div>

            <div class="form-group">
                <label for="teamName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã:</label>
                <input type="text" id="teamName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–Ω–µ–∂–∏–Ω–∫–∏" maxlength="30">
            </div>

            <div class="form-group">
                <label for="captainName">–ò–º—è –∫–∞–ø–∏—Ç–∞–Ω–∞:</label>
                <input type="text" id="captainName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω" maxlength="20">
            </div>

            <div style="text-align: center;">
                <button class="btn btn-success" onclick="startGame()">üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É!</button>
            </div>

            <div id="startAlert" class="alert"></div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div class="game-screen" id="gameScreen">
            <div class="header">
                <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –û—Ö–æ—Ç–∞ –∑–∞ –°–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</h1>
                <div style="color: #666; margin-top: 10px;">
                    –ö–æ–º–∞–Ω–¥–∞: <span id="displayTeamName"></span> | 
                    –ö–∞–ø–∏—Ç–∞–Ω: <span id="displayCaptainName"></span>
                </div>
            </div>

            <div class="timer-container">
                <div class="timer-title">‚è∞ –í—Ä–µ–º—è –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã:</div>
                <div class="timer-display" id="timerDisplay">30:00</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">–ó–∞–¥–∞–Ω–∏–µ 1 –∏–∑ 5</div>
            </div>

            <div class="task-container" id="taskContainer">
                <!-- –ó–∞–¥–∞–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–¥–µ—Å—å -->
            </div>

            <div id="gameAlert" class="alert"></div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
        <div class="end-screen" id="endScreen">
            <div class="header">
                <h1>üéä –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h1>
                <div class="version">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ</div>
            </div>

            <div style="text-align: center; margin-bottom: 30px;">
                <p style="font-size: 18px; color: #666;">
                    –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–∏!
                </p>
            </div>

            <div style="text-align: center;">
                <button class="btn" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
    <div class="modal" id="gameEndModal">
        <div class="modal-content">
            <div class="trophy">üèÜ</div>
            <h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
            <p style="color: #666; margin-bottom: 20px;">–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!</p>
            
            <div class="stats">
                <div class="stat-item">
                    <span>–ö–æ–º–∞–Ω–¥–∞:</span>
                    <span id="finalTeamName"></span>
                </div>
                <div class="stat-item">
                    <span>–ö–∞–ø–∏—Ç–∞–Ω:</span>
                    <span id="finalCaptainName"></span>
                </div>
                <div class="stat-item">
                    <span>–ó–∞–¥–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
                    <span id="finalTasksCount">0 –∏–∑ 5</span>
                </div>
                <div class="stat-item">
                    <span>–í—Ä–µ–º—è –∏–≥—Ä—ã:</span>
                    <span id="finalTime">00:00</span>
                </div>
                <div class="stat-item">
                    <span>–ò—Ç–æ–≥–æ–≤—ã–π —Å—á–µ—Ç:</span>
                    <span id="finalScore">0 –æ—á–∫–æ–≤</span>
                </div>
            </div>

            <button class="btn btn-success" onclick="closeModal()">–û—Ç–ª–∏—á–Ω–æ!</button>
        </div>
    </div>

    <script>
        // üìä –ò–ì–†–û–í–´–ï –î–ê–ù–ù–´–ï
        const GAME_DATA = {
            tasks: [
                {
                    id: 1,
                    title: "üéÖ –ù–∞–π–¥–∏—Ç–µ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞",
                    description: "–î–µ–¥ –ú–æ—Ä–æ–∑ —Å–ø—Ä—è—Ç–∞–ª—Å—è –≤ —Å–∞–º–æ–º –∫—Ä–∞—Å–∏–≤–æ–º –º–µ—Å—Ç–µ. –û–Ω –æ—Å—Ç–∞–≤–∏–ª –ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ —Å –µ–ª–∫–æ–π.",
                    hint: "–ò—â–∏—Ç–µ —Ç–∞–º, –≥–¥–µ –≤–∏—Å—è—Ç –∏–≥—Ä—É—à–∫–∏ –∏ –º–∏—à—É—Ä–∞",
                    code: "XMAS2025",
                    points: 100
                },
                {
                    id: 2,
                    title: "‚ùÑÔ∏è –°–Ω–µ–∂–∏–Ω–∫–∞ —Å —Å–µ–∫—Ä–µ—Ç–æ–º",
                    description: "–ë–æ–ª—å—à–∞—è —Å–Ω–µ–∂–∏–Ω–∫–∞ —É –≤—Ö–æ–¥–∞ —Ö—Ä–∞–Ω–∏—Ç –≤–∞–∂–Ω—ã–π –∫–æ–¥. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ –≤—Å–µ —É–∑–æ—Ä—ã.",
                    hint: "–°—á–∏—Ç–∞–π—Ç–µ –ª—É—á–∏–∫–∏ —É —Å–∞–º–æ–π –±–æ–ª—å—à–æ–π —Å–Ω–µ–∂–∏–Ω–∫–∏",
                    code: "SNOWFLAKE",
                    points: 150
                },
                {
                    id: 3,
                    title: "üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∑–∞–≥–∞–¥–∫–∞",
                    description: "–í —è—Ä–∫–æ–π –ø–æ–¥–∞—Ä–æ—á–Ω–æ–π –∫–æ—Ä–æ–±–∫–µ –ª–µ–∂–∏—Ç —Å—é—Ä–ø—Ä–∏–∑. –ù–æ —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Ä–∞–∑–≥–∞–¥–∞—Ç—å —à–∏—Ñ—Ä –Ω–∞ –±–∞–Ω—Ç–µ.",
                    hint: "–ë—É–∫–≤—ã –æ–±—Ä–∞–∑—É—é—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –ø–æ–¥–∞—Ä–∫–∞",
                    code: "PRESENT",
                    points: 200
                },
                {
                    id: 4,
                    title: "üîî –†–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫–∏–π –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫",
                    description: "–ó–≤–µ–Ω—è—â–∏–π –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫ –æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ö–æ–¥ –≤ —Ç–∞–π–Ω—É—é –∫–æ–º–Ω–∞—Ç—É. –ù–∞–π–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã –Ω–∞ –µ–≥–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.",
                    hint: "–¶–∏—Ñ—Ä—ã —Å–≤—è–∑–∞–Ω—ã —Å –¥–∞—Ç–æ–π –ø—Ä–∞–∑–¥–Ω–∏–∫–∞",
                    code: "BELLS",
                    points: 175
                },
                {
                    id: 5,
                    title: "üåü –ó–≤–µ–∑–¥–∞ –Ω–∞ –µ–ª–∫–µ",
                    description: "–°–∞–º–∞—è —è—Ä–∫–∞—è –∑–≤–µ–∑–¥–∞ –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ –µ–ª–∫–∏ —Å–≤–µ—Ç–∏—Ç—Å—è –Ω–µ–æ–±—ã—á–Ω—ã–º —Å–≤–µ—Ç–æ–º. –≠—Ç–æ –∑–Ω–∞–∫!",
                    hint: "–í–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –∑–≤–µ–∑–¥—ã –≤ –æ–∫–Ω–µ",
                    code: "STARLIGHT",
                    points: 225
                }
            ]
        };

        // üéÆ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´
        const GAME_CONFIG = {
            gameDuration: 30 * 60, // 30 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState: {
                startTime: null,
                currentTask: 0,
                completedTasks: [],
                totalScore: 0,
                teamName: '',
                captainName: '',
                hintsUsed: 0,
                taskHistory: [],
                totalTimeSpent: 0,
                gameStart: null
            }
        };

        let firebaseDB = null;
        let gameTimer = null;

        // üåü –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        function initGame() {
            // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏
            createSnowflakes();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã
            updateGameTitle();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            initFirebase();
        }

        function updateGameTitle() {
            const gameTitle = localStorage.getItem('game_title') || '–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –û—Ö–æ—Ç–∞ –∑–∞ –°–æ–∫—Ä–æ–≤–∏—â–∞–º–∏';
            const h1Elements = document.querySelectorAll('.header h1');
            h1Elements.forEach(h1 => {
                h1.textContent = `üéÑ ${gameTitle}`;
            });
        }

        function initFirebase() {
            if (window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.enabled) {
                try {
                    firebase.initializeApp(window.FIREBASE_CONFIG);
                    firebaseDB = firebase.database();
                    console.log('‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
                } catch (error) {
                    console.error('‚ùå Firebase –æ—à–∏–±–∫–∞:', error);
                }
            }
        }

        // ‚ùÑÔ∏è –°–û–ó–î–ê–ù–ò–ï –°–ù–ï–ñ–ò–ù–û–ö
        function createSnowflakes() {
            const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
            const existingFlakes = document.querySelectorAll('.snowflake');
            
            for (let i = existingFlakes.length; i < 15; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                flake.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(flake);
            }
        }

        // üöÄ –°–¢–ê–†–¢ –ò–ì–†–´
        function startGame() {
            const teamName = document.getElementById('teamName').value.trim();
            const captainName = document.getElementById('captainName').value.trim();

            if (!teamName || !captainName) {
                showAlert('startAlert', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
            GAME_CONFIG.gameState.teamName = teamName;
            GAME_CONFIG.gameState.captainName = captainName;
            GAME_CONFIG.gameState.startTime = Date.now();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
            document.getElementById('startScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
            document.getElementById('displayTeamName').textContent = teamName;
            document.getElementById('displayCaptainName').textContent = captainName;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
            loadCurrentTask();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startTimer();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª–æ –∏–≥—Ä—ã –≤ Firebase
            saveGameStart();
        }

        // ‚è∞ –¢–ê–ô–ú–ï–†
        function startTimer() {
            gameTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - GAME_CONFIG.gameState.startTime) / 1000);
                const remaining = Math.max(0, GAME_CONFIG.gameDuration - elapsed);
                
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                
                document.getElementById('timerDisplay').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                if (remaining === 0) {
                    endGame();
                }
            }, 1000);
        }

        // üìã –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ù–ò–Ø
        function loadCurrentTask() {
            const task = GAME_DATA.tasks[GAME_CONFIG.gameState.currentTask];
            const container = document.getElementById('taskContainer');

            container.innerHTML = `
                <div class="task-header">
                    <div class="task-number">${task.id}</div>
                    <div class="task-title">${task.title}</div>
                    <div class="task-score">${task.points} –æ—á–∫–æ–≤</div>
                </div>
                
                <div class="task-description">
                    ${task.description}
                </div>
                
                <div class="task-hint-section">
                    <button class="btn-hint" onclick="showHint()" id="hintButton">
                        üí° –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É (-20 –æ—á–∫–æ–≤)
                    </button>
                    <div class="task-hint" id="taskHint" style="display: none;">
                        üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: ${task.hint}
                        <div class="hint-penalty" style="color: #e74c3c; font-size: 12px; margin-top: 5px;">
                            ‚ö†Ô∏è –®—Ç—Ä–∞—Ñ –ø—Ä–∏–º–µ–Ω–µ–Ω: -20 –æ—á–∫–æ–≤
                        </div>
                    </div>
                </div>
                
                <div class="task-code">
                    <input type="text" id="taskInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥" maxlength="20" onkeyup="checkCode(event)">
                    <button class="btn-check-code" onclick="checkCodeButton()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥</button>
                </div>
            `;

            updateProgress();
        }

        // üîç –ü–†–û–í–ï–†–ö–ê –ö–û–î–ê (Enter)
        function checkCode(event) {
            if (event.key === 'Enter') {
                checkCodeButton();
            }
        }

        // üîç –ü–†–û–í–ï–†–ö–ê –ö–û–î–ê (–ö–Ω–æ–ø–∫–∞)
        function checkCodeButton() {
            const input = document.getElementById('taskInput');
            const code = input.value.trim().toUpperCase();
            const currentTask = GAME_DATA.tasks[GAME_CONFIG.gameState.currentTask];

            if (!code) {
                showAlert('gameAlert', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥!', 'error');
                return;
            }

            if (code === currentTask.code) {
                // –ö–æ–¥ –≤–µ—Ä–Ω—ã–π!
                completeTask();
            } else {
                // –ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π
                showAlert('gameAlert', '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!', 'error');
                input.value = '';
            }
        }

        // üí° –ü–û–ö–ê–ó –ü–û–î–°–ö–ê–ó–ö–ò –° –®–¢–†–ê–§–û–ú
        function showHint() {
            const currentTask = GAME_DATA.tasks[GAME_CONFIG.gameState.currentTask];
            const hintPenalty = 20; // –®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —à—Ç—Ä–∞—Ñ
            GAME_CONFIG.gameState.totalScore = Math.max(0, GAME_CONFIG.gameState.totalScore - hintPenalty);
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
            if (!GAME_CONFIG.gameState.hintsUsed) {
                GAME_CONFIG.gameState.hintsUsed = 0;
            }
            GAME_CONFIG.gameState.hintsUsed++;
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —à—Ç—Ä–∞—Ñ –≤ –∏—Å—Ç–æ—Ä–∏—é
            GAME_CONFIG.gameState.taskHistory.push({
                taskId: currentTask.id,
                points: -hintPenalty,
                hintUsed: true,
                timestamp: Date.now()
            });
            
            const hintButton = document.getElementById('hintButton');
            const taskHint = document.getElementById('taskHint');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            hintButton.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            taskHint.style.display = 'block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —à—Ç—Ä–∞—Ñ–µ
            showAlert('gameAlert', 'üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∞! -20 –æ—á–∫–æ–≤ –∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É', 'warning');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            updateProgress();
        }

        // ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø
        function completeTask() {
            const currentTask = GAME_DATA.tasks[GAME_CONFIG.gameState.currentTask];
            const gameStartTime = GAME_CONFIG.gameState.startTime;
            const currentTime = Date.now();
            
            // –í—ã—á–∏—Å–ª—è–µ–º –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
            const taskTime = currentTime - gameStartTime - (GAME_CONFIG.gameState.totalTimeSpent || 0);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!GAME_CONFIG.gameState.taskHistory) {
                GAME_CONFIG.gameState.taskHistory = [];
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            const difficultyMultipliers = {
                'easy': 1.0,
                'medium': 1.5, 
                'hard': 2.0
            };
            const difficultyMultiplier = difficultyMultipliers[currentTask.difficulty] || 1.0;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –±–æ–Ω—É—Å –∑–∞ –≤—Ä–µ–º—è (—á–µ–º –±—ã—Å—Ç—Ä–µ–µ, —Ç–µ–º –ª—É—á—à–µ)
            const maxTaskTime = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
            const timeBonus = Math.max(0, (maxTaskTime - taskTime) / maxTaskTime * 0.2); // –¥–æ 20% –±–æ–Ω—É—Å–∞
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ—á–∫–∏ –∑–∞ –∑–∞–¥–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
            const taskPoints = Math.round(currentTask.points * difficultyMultiplier * (1 + timeBonus));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –∑–∞–¥–∞–Ω–∏—è
            GAME_CONFIG.gameState.taskHistory.push({
                taskId: currentTask.id,
                taskNumber: currentTask.number,
                title: currentTask.title,
                difficulty: currentTask.difficulty,
                basePoints: currentTask.points,
                difficultyMultiplier: difficultyMultiplier,
                timeBonus: timeBonus,
                finalPoints: taskPoints,
                taskTime: Math.round(taskTime / 1000), // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                timestamp: currentTime
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è
            if (!GAME_CONFIG.gameState.totalTimeSpent) {
                GAME_CONFIG.gameState.totalTimeSpent = 0;
            }
            GAME_CONFIG.gameState.totalTimeSpent += taskTime;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
            GAME_CONFIG.gameState.completedTasks.push({
                taskId: currentTask.id,
                points: taskPoints,
                difficulty: currentTask.difficulty,
                timeSpent: Math.round(taskTime / 1000),
                timestamp: currentTime
            });

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç
            GAME_CONFIG.gameState.totalScore += taskPoints;

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é
            GAME_CONFIG.gameState.currentTask++;

            if (GAME_CONFIG.gameState.currentTask >= GAME_DATA.tasks.length) {
                // –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã
                endGame();
            } else {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ
                showAlert('gameAlert', `‚úÖ –û—Ç–ª–∏—á–Ω–æ! –ö–æ–¥ "${currentTask.code}" –≤–µ—Ä–Ω—ã–π! +${taskPoints} –æ—á–∫–æ–≤ (—Å–ª–æ–∂–Ω–æ—Å—Ç—å: ${currentTask.difficulty})`, 'success');
                
                setTimeout(() => {
                    loadCurrentTask();
                }, 2000);
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ Firebase
            saveGameProgress();
        }

        // üìä –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–ì–†–ï–°–°–ê
        function updateProgress() {
            const progress = (GAME_CONFIG.gameState.currentTask / GAME_DATA.tasks.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `–ó–∞–¥–∞–Ω–∏–µ ${GAME_CONFIG.gameState.currentTask + 1} –∏–∑ ${GAME_DATA.tasks.length}`;
        }

        // üèÅ –ó–ê–í–ï–†–®–ï–ù–ò–ï –ò–ì–†–´
        function endGame() {
            clearInterval(gameTimer);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            showGameEndModal();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            saveGameResults();
        }

        // üèÜ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ó–ê–í–ï–†–®–ï–ù–ò–Ø
        function showGameEndModal() {
            const gameTime = Math.floor((Date.now() - GAME_CONFIG.gameState.startTime) / 1000);
            const minutes = Math.floor(gameTime / 60);
            const seconds = gameTime % 60;

            document.getElementById('finalTeamName').textContent = GAME_CONFIG.gameState.teamName;
            document.getElementById('finalCaptainName').textContent = GAME_CONFIG.gameState.captainName;
            document.getElementById('finalTasksCount').textContent = 
                `${GAME_CONFIG.gameState.completedTasks.length} –∏–∑ ${GAME_DATA.tasks.length}`;
            document.getElementById('finalTime').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('finalScore').textContent = `${GAME_CONFIG.gameState.totalScore} –æ—á–∫–æ–≤`;

            document.getElementById('gameEndModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('gameEndModal').classList.remove('show');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('endScreen').classList.add('active');
        }

        // üîÑ –ü–ï–†–ï–ó–ê–ü–£–°–ö
        function restartGame() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            GAME_CONFIG.gameState = {
                startTime: null,
                currentTask: 0,
                completedTasks: [],
                totalScore: 0,
                teamName: '',
                captainName: '',
                hintsUsed: 0,
                taskHistory: [],
                totalTimeSpent: 0,
                gameStart: null
            };

            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            document.getElementById('teamName').value = '';
            document.getElementById('captainName').value = '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
            document.getElementById('endScreen').classList.remove('active');
            document.getElementById('startScreen').classList.add('active');

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            if (gameTimer) {
                clearInterval(gameTimer);
            }
        }

        // üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –í FIREBASE
        function saveGameStart() {
            if (!firebaseDB) return;

            const gameId = 'game_' + Date.now();
            
            firebaseDB.ref('games/' + gameId).set({
                teamName: GAME_CONFIG.gameState.teamName,
                captainName: GAME_CONFIG.gameState.captainName,
                startTime: GAME_CONFIG.gameState.startTime,
                status: 'started'
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:', error);
            });
        }

        function saveGameProgress() {
            if (!firebaseDB) return;

            const gameId = 'game_' + GAME_CONFIG.gameState.startTime;
            
            firebaseDB.ref('games/' + gameId).update({
                currentTask: GAME_CONFIG.gameState.currentTask,
                completedTasks: GAME_CONFIG.gameState.completedTasks,
                totalScore: GAME_CONFIG.gameState.totalScore,
                status: 'in_progress'
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
            });
        }

        function saveGameResults() {
            if (!firebaseDB) return;

            const gameId = 'game_' + GAME_CONFIG.gameState.startTime;
            const gameTime = Math.floor((Date.now() - GAME_CONFIG.gameState.startTime) / 1000);

            firebaseDB.ref('games/' + gameId).update({
                endTime: Date.now(),
                gameDuration: gameTime,
                completedTasks: GAME_CONFIG.gameState.completedTasks,
                totalScore: GAME_CONFIG.gameState.totalScore,
                status: 'completed'
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            firebaseDB.ref('results').push({
                teamName: GAME_CONFIG.gameState.teamName,
                captainName: GAME_CONFIG.gameState.captainName,
                finalScore: GAME_CONFIG.gameState.totalScore,
                completedTasks: GAME_CONFIG.gameState.completedTasks.length,
                gameTime: gameTime,
                endTime: Date.now(),
                accessCode: window.GAME_ACCESS_CODE,
                hintsUsed: GAME_CONFIG.gameState.hintsUsed || 0,
                taskHistory: GAME_CONFIG.gameState.taskHistory || [],
                totalTimeSpent: GAME_CONFIG.gameState.totalTimeSpent || 0,
                averageTaskTime: GAME_CONFIG.gameState.completedTasks.length > 0 ? 
                    Math.round((GAME_CONFIG.gameState.totalTimeSpent || 0) / GAME_CONFIG.gameState.completedTasks.length / 1000) : 0
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            });
        }

        // ‚ö†Ô∏è –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
        function showAlert(elementId, message, type) {
            const alert = document.getElementById(elementId);
            alert.textContent = message;
            alert.className = 'alert alert-' + type + ' show';
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>